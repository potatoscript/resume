<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<head>
  <script type="text/javascript" src="../../potato.js/js/enchant.js"></script> 
</head>
  <body>

    <script>
		enchant();
		var _moveright_boy=false;
		var _movedown_boy=false;
		
		var _moveright_girl=false;
		var _movedown_girl=false;
		
		
		var moveRight ={girl:true,boy:true,chicken:false};
		var moveLeft ={girl:false,boy:false,chicken:false};
		var moveUp ={girl:false,boy:false,chicken:false};
		var moveDown ={girl:false,boy:false,chicken:false};
		
		var core,
		door,
		door2,
		chicken,chicken_right_frame,chicken_left_frame,chicken_down_frame,chicken_up_frame,label_chicken,
		boy,label_boy,
		girl,right_frame,left_frame,right_frame_girl,left_frame_girl,label_girl;
		
		window.onload = function(){
			
			//game object creation;
			core = new Core(450,450);
			core.fps = 10;	
			core.overflow ="hidden";
			//image loading	
			core.preload("images/boy.png","images/girl.png","images/chicken.png","images/object.png");			
			core.onload = function(){

				door = new Sprite(126,141);
				door.image = core.assets["images/object.png"];
				door.scale(0.3,0.3);
				door.x = -50; 
				door.y = -40;
				door.frame = 1;//init frame
				
				door2 = new Sprite(126,141);
				door2.image = core.assets["images/object.png"];
				door2.scale(0.3,0.3);
				door2.x = 350; 
				door2.y = -40;
				door2.frame = 2;//init frame


				chicken = new Sprite(32,32);
				chicken.image = core.assets["images/chicken.png"];
				chicken.scale(0.8,0.8);
				chicken.x = 200; 
				chicken.y = 18;
				chicken.frame = 5;//init frame


				boy = new Sprite(65,65);
				boy.image = core.assets["images/boy.png"];
				boy.scale(0.6,0.6);
				boy.x = 10;
				boy.frame = 18;//init frame
				right_frame = boy.frame;
				left_frame = 15;
				down_frame = 0;
				up_frame = 21;

				girl = new Sprite(32,32);
				girl.image = core.assets["images/girl.png"];
				girl.scale(1.2,1.2);
				girl.x = 100;
				girl.y =10;
				girl.frame = 24;
				right_frame_girl = girl.frame;
				left_frame_girl = 15;

				createDoor();
				createBoy();
				createGirl();
				createchicken();
				
			}
			core.start();
		}

		function createBoy(){

				label_boy = new Label();
				label_boy.color = 'blue';
				label_boy.fontSize = "10px";
				core.rootScene.addChild(label_boy);
				label_boy.opacity = 0;
				
				label_boy.text = "こにちは";
				//frame loop to move the bear every frame
				boy.addEventListener(Event.ENTER_FRAME, function() {
					label_boy.opacity = 0;
					label_boy.x = boy.x;
					//label_boy.text = "こにちは";
					var speed = 3;//Math.floor((Math.random() * 5) + 1);
					
					if(moveLeft.boy==true){
						_moveright_boy=false;
						this.x -=speed;//speed
						this.frame = this.age % 3+left_frame;
						if(this.x<0){

							moveUp.boy=false;
							moveDown.boy=false;
							moveLeft.boy=false;
							moveRight.boy=true;
						}
					}
					if(moveRight.boy==true){
						_moveright_boy=true;
						this.x +=speed;
						this.frame = this.age % 3+right_frame;
						if(this.x>400){
							moveRight.boy=false;
							moveUp.boy=false;
							moveDown.boy=false;
							moveLeft.boy=true;
						}
					}
					if(moveDown.boy==true){
						_movedown_boy=true;
						this.frame = this.age % 3+down_frame;
						this.y +=speed;
						
						if(this.y>200){
							moveRight.boy=false;
							moveDown.boy=false;
							moveLeft.boy=false;
							moveUp.boy=true;
						}
					}
					if(moveUp.boy==true){
						_movedown_boy=false;
						this.frame = this.age % 3+up_frame;
						this.y -=speed;
						
						if(this.y < 1){
							
							if(this.x<300){
								moveUp.boy=false;
								moveDown.boy=false;
								moveLeft.boy=false;
								moveRight.boy=true;
							}else{
								moveRight.boy=false;
								moveUp.boy=false;
								moveDown.boy=false;
								moveLeft.boy=true;
							}
						}
					}
					/*
					if(this.within(girl, 20)){
						//stop all the movement;
						moveRight.boy=false;
						moveLeft.boy=false;
						moveDown.boy=false;
						moveUp.boy=false;
						
						label_boy.opacity = 1;

						if(_moveright_boy==false ){
							boy.frame = boy.age % 3+left_frame;
							setTimeout(function(){
								moveLeft.boy=true;
							}, 1000)
						}
						if(_moveright_boy==true){
							
							setTimeout(function(){
								moveDown.boy=true;
							}, 1000)
							
						}
						
						//when girl meet with the boy
						if(_moveright_girl==true && _moveright_boy == true){
							moveRight.girl=false;
							moveLeft.girl=false;
							girl.frame = girl.age % 3+left_frame_girl;//turn face
							label_girl.opacity = 1;
							label_girl.x = girl.x;
							   label_girl.text = "Hi";
							   //label_boy.text = "こにちは";
							   //label_boy.opacity = 1;
							setTimeout(function(){
								moveRight.girl=true;
							}, 1000)
						}
						if(_moveright_girl==true && _moveright_boy == false){
							moveRight.girl=false;
							moveLeft.girl=false;
							girl.frame = girl.age % 3+right_frame_girl;
							label_girl.text = "Hi";
							label_boy.text = "Hi";
							label_boy.opacity = 1;
							label_girl.opacity = 1;
							label_girl.x = girl.x;
							setTimeout(function(){
								moveRight.girl=true;
							}, 1000)
						}
							
						
					}
					*/
					
					
					meetchicken(boy,"boy");
					intoLeftDoor(boy,"boy",1000);
					intoLeftDoor2(boy,"boy",1000);
					
					
				}); 
				//add the boy to the display object tree
				core.rootScene.addChild(boy);
		}
		function createGirl(){

				label_girl = new Label();
				
				label_girl.fontSize = "10px";
				label_girl.color = 'red';
				core.rootScene.addChild(label_girl);
				label_girl.opacity = 0;

				//frame loop to move the bear every frame
				girl.addEventListener(Event.ENTER_FRAME, function() {
					label_girl.opacity = 0;
					label_girl.x = girl.x;
					label_girl.text = "こにちは";
					var speed = 3;//Math.floor((Math.random() * 5) + 1);
					if(moveLeft.girl==true){
						_moveright_girl=false;
						this.x -=speed;
						this.frame = this.age % 3+left_frame_girl;
						if(this.x<0){
							moveLeft.girl=false;
							moveRight.girl=true;
						}
					}
					if(moveRight.girl==true){
						_moveright_girl=true;
						this.x +=speed;
						this.frame = this.age % 3+right_frame_girl;
						if(this.x>400){
							moveRight.girl=false;
							moveLeft.girl=true;
						}
					}

					meetchicken(girl,"girl");
					intoLeftDoor(girl,"girl",3000);
					intoLeftDoor2(girl,"girl",5000);
					
					
				}); 
				core.rootScene.addChild(girl);
		}
		
		function createchicken(){

				chicken.addEventListener(Event.ENTER_FRAME, function() {
					
				}); 
				core.rootScene.addChild(chicken);
		}
		
		function createDoor(){

				core.rootScene.addChild(door);
				core.rootScene.addChild(door2);
				
		}
		
		function meetchicken(obj,chara){
			if(obj.within(chicken, 10)){
				if(moveRight[chara]==true){	
					obj.y -=10;
					//chicken.frame = chicken.age % 2+4;//turn face
				}
				if(moveLeft[chara]==true){						
					chicken.frame = chicken.age % 2+4;//turn face
				}
				setTimeout(function(){
					chicken.frame = 5;
					if(moveRight[chara]==true)obj.y +=10;
				},500);
			}
			
		}
		
		function intoLeftDoor(obj,chara,time){
		
			if(obj.within(door, 30) && moveLeft[chara]==true){//make sure the girl is go in not out
				door.frame = 6;//open the door
				
				setTimeout(function(){
					//go inside the door
					moveLeft[chara]=false;
					moveRight[chara]=false;
					moveUp[chara]=false;
					moveDown[chara]=false;
					obj.opacity=0;
					
					setTimeout(function(){
						door.frame = 1;//door close
						
						setTimeout(function(){
							door.frame = 6;//door open
							setTimeout(function(){
								obj.x=0;
								moveRight[chara]=true;
								obj.opacity=1;
								setTimeout(function(){
									door.frame = 1;
								}, 500)
							}, 500)
						}, time)
						
					}, 500)
				}, 300)
			}
		}
		
		function intoLeftDoor2(obj,chara,time){
		
			if(obj.within(door2, 30) && moveRight[chara]==true){//make sure the girl is go in not out
				door2.frame = 8;//open the door
				
				setTimeout(function(){
					//go inside the door
					moveLeft[chara]=false;
					moveRight[chara]=false;
					moveUp[chara]=false;
					moveDown[chara]=false;
					obj.opacity=0;
					
					setTimeout(function(){
						door2.frame = 2;//door close
						
						setTimeout(function(){
							door2.frame = 8;//door open
							setTimeout(function(){
								obj.x=390;
								moveLeft[chara]=true;
								obj.opacity=1;
								setTimeout(function(){
									door2.frame = 2;
								}, 500)
							}, 500)
						}, time)
						
					}, 500)
				}, 300)
			}
		}
		
		
		
	</script>
  </body>

</html>
