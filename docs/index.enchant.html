<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<head>
  <script type="text/javascript" src="../../potato.js/js/enchant.js"></script> 
</head>
  <body>

    <script>
		enchant();
		var _moveright_boy=false;
		var _movedown_boy=false;
		
		var _moveright_girl=false;
		var _movedown_girl=false;
		
		var moveup = false;
		var movedown = false;
		var moveleft = false;
		var moveright = true;
		
		var moveup_girl = false;
		var movedown_girl = false;
		var moveleft_girl = false;
		var moveright_girl = true;
		
		var core,boy,girl,right_frame,left_frame,right_frame_girl,left_frame_girl,label_boy,label_girl;
		
		window.onload = function(){
			
			//game object creation;
			core = new Core(450,450);
			core.fps = 10;	
			core.overflow ="hidden";
			//image loading	
			core.preload("images/boy.png","images/girl.png");			
			core.onload = function(){

				boy = new Sprite(65,65);
				boy.image = core.assets["images/boy.png"];
				boy.scale(0.6,0.6);
				boy.x = 10;
				boy.frame = 18;//init frame
				right_frame = boy.frame;
				left_frame = 15;
				down_frame = 0;
				up_frame = 21;

				girl = new Sprite(32,32);
				girl.image = core.assets["images/girl.png"];
				girl.scale(1.2,1.2);
				girl.x = 100;
				girl.y =10;
				girl.frame = 24;
				right_frame_girl = girl.frame;
				left_frame_girl = 15;

				createBoy();
				createGirl();
				
			}
			core.start();
		}

		function createBoy(){

				label_boy = new Label();
				label_boy.color = 'blue';
				label_boy.fontSize = "10px";
				core.rootScene.addChild(label_boy);
				label_boy.opacity = 0;
				
				label_boy.text = "こにちは";
				//frame loop to move the bear every frame
				boy.addEventListener(Event.ENTER_FRAME, function() {
					label_boy.opacity = 0;
					label_boy.x = boy.x;
					//label_boy.text = "こにちは";
					var speed = Math.floor((Math.random() * 5) + 1);
					if(moveleft==true){
						_moveright_boy=false;
						this.x -=speed;//speed
						this.frame = this.age % 3+left_frame;
						if(this.x<10){
							moveleft=false;
							moveup=false;
							movedown=false;
							moveright=true;
						}
					}
					if(moveright==true){
						_moveright_boy=true;
						this.x +=speed;
						this.frame = this.age % 3+right_frame;
						if(this.x>400){
							moveright=false;
							moveup=false;
							movedown=false;
							moveleft=true;
						}
					}
					if(movedown==true){
						_movedown_boy=true;
						this.frame = this.age % 3+down_frame;
						this.y +=speed;
						
						if(this.y>200){
							moveright=false;
							moveup=true;
							movedown=false;
							moveleft=false;
						}
					}
					if(moveup==true){
						_movedown_boy=false;
						this.frame = this.age % 3+up_frame;
						this.y -=speed;
						
						if(this.y < 1){
							if(this.x<300){
								moveright=true;
								moveup=false;
								movedown=false;
								moveleft=false;
							}else{
								moveright=false;
								moveup=false;
								movedown=false;
								moveleft=true;
							}
						}
					}
					if(this.intersect(girl)){
						//stop all the movement;
						moveright=false;
						moveleft=false;
						movedown=false;
						moveup=false;
						
						label_boy.opacity = 1;

						if(_moveright_boy==false ){
							boy.frame = boy.age % 3+left_frame;
							setTimeout(function(){
								moveleft=true;
							}, 1000)
						}
						if(_moveright_boy==true){
							
							setTimeout(function(){
								movedown=true;
							}, 1000)
							
						}
						
						//when girl meet with the boy
						if(_moveright_girl==true && _moveright_boy == true){
							moveright_girl=false;
							moveleft_girl=false;
							girl.frame = girl.age % 3+left_frame_girl;//turn face
							label_girl.opacity = 1;
							label_girl.x = girl.x;
							   label_girl.text = "Hi";
							   //label_boy.text = "こにちは";
							   //label_boy.opacity = 1;
							setTimeout(function(){
								moveright_girl=true;
							}, 1000)
						}
						if(_moveright_girl==true && _moveright_boy == false){
							moveright_girl=false;
							moveleft_girl=false;
							girl.frame = girl.age % 3+right_frame_girl;
							label_girl.text = "Hi";
							label_boy.text = "Hi";
							label_boy.opacity = 1;
							label_girl.opacity = 1;
							label_girl.x = girl.x;
							setTimeout(function(){
								moveright_girl=true;
							}, 1000)
						}
							
						
					}
				}); 
				//add the boy to the display object tree
				core.rootScene.addChild(boy);
		}
		function createGirl(){

				label_girl = new Label();
				
				label_girl.fontSize = "10px";
				label_girl.color = 'red';
				core.rootScene.addChild(label_girl);
				label_girl.opacity = 0;

				//frame loop to move the bear every frame
				girl.addEventListener(Event.ENTER_FRAME, function() {
					label_girl.opacity = 0;
					label_girl.x = girl.x;
					label_girl.text = "こにちは";
					var speed = Math.floor((Math.random() * 5) + 1);
					if(moveleft_girl==true){
						_moveright_girl=false;
						this.x -=speed;
						this.frame = this.age % 3+left_frame_girl;
						if(this.x<10){
							moveleft_girl=false;
							moveright_girl=true;
						}
					}
					if(moveright_girl==true){
						_moveright_girl=true;
						this.x +=speed;
						this.frame = this.age % 3+right_frame_girl;
						if(this.x>400){
							moveright_girl=false;
							moveleft_girl=true;
						}
					}
					/*
					if(this.intersect(boy)){
						if(this.x>70 && this.x<300 && _moveright_girl!=_moveright_boy){
							moveright_girl=false;
							moveleft_girl=false;
							label.opacity = 1;
							label.x = this.x;
							
							//label.y = this.y+10;
							if(_moveright_girl==false){
								this.frame = this.age % 3+left_frame_girl;
								setTimeout(function(){
									label.opacity = 0;
									moveleft_girl=true;
								}, 1000)
							}
							if(_moveright_girl==true){
								this.frame = this.age % 3+right_frame_girl;
								setTimeout(function(){
									label.opacity = 0;
									moveright_girl=true;
								}, 1000)
							}
						}

					}
					*/

				}); 
				core.rootScene.addChild(girl);
		}
		
		
		
	</script>
  </body>

</html>
